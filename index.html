<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="dluvbell">
    <title data-lang-key="pageTitle">Comprehensive Retirement Simulator</title>
    <link rel="stylesheet" href="style.css">
    </head>
<body>

    <div class="container">
        <header>
            <h1 data-lang-key="mainTitle">Comprehensive Retirement Simulator</h1>
            <p data-lang-key="subTitle">Compare two retirement scenarios.</p>
            <div class="header-controls">
                <div class="theme-switch-wrapper">
                    <label class="theme-switch" for="theme-toggle">
                        <input type="checkbox" id="theme-toggle" />
                        <div class="slider round"></div>
                    </label>
                    <span data-lang-key="darkModeLabel">Dark Mode</span>
                </div>
                <button id="lang-toggle" type="button">한국어</button>
            </div>
        </header>

        <nav class="tab-nav">
            <button class="tab-btn active" data-tab="scenarioA" data-lang-key="tabScenarioA">Scenario A</button>
            <button class="tab-btn" data-tab="scenarioB" data-lang-key="tabScenarioB">Scenario B</button>
            <button class="tab-btn" data-tab="results" data-lang-key="tabResults">Results</button>
        </nav>

        <main class="tab-content-container">
            <div id="scenarioA-pane" class="tab-pane active">
                <div class="input-section">
                    <h2 data-lang-key="section1Title">1. Enter Information (Scenario A)</h2>

                    <div class="form-group data-entry-target-selector">
                        <label for="dataEntryTarget_a" data-lang-key="dataEntryTargetLabel">Data Entry For:</label>
                        <select id="dataEntryTarget_a">
                            <option value="user" data-lang-key="dataEntryMe">Me</option>
                            <option value="spouse" data-lang-key="dataEntrySpouse">Spouse</option>
                        </select>
                    </div>

                    <div class="form-grid">
                        <fieldset>
                            <legend data-lang-key="legendBasicInfo">Basic Information</legend>
                             <div class="form-group">
                                <label for="province" data-lang-key="provinceLabel">Province of Residence</label>
                                <select id="province"></select>
                            </div>
                           <div class="form-group">
                                <label for="retirementAge_a" data-lang-key="retirementAgeLabel">Retirement Age</label>
                                <input type="number" id="retirementAge_a" value="61">
                            </div>
                             <div class="form-group">
                                <label for="lifeExpectancy" data-lang-key="lifeExpectancyLabel">Maximum Calculation Age</label>
                                <input type="number" id="lifeExpectancy" value="95">
                            </div>
                        </fieldset>

                        <fieldset>
                            <legend data-lang-key="legendYourInfo">Income Plan</legend> <div class="form-group">
                                <label for="userBirthYear" data-lang-key="userBirthYearLabel">Birth Year</label>
                                <input type="number" id="userBirthYear" value="1981">
                            </div>
                             <div class="form-group">
                                <label for="cppStartAge_a" data-lang-key="cppStartAgeLabel">CPP Start Age</label>
                                <input type="number" id="cppStartAge_a" value="61">
                            </div>
                             <div class="form-group">
                                <label for="userCppAt65" data-lang-key="userCppAt65Label">Estimated CPP at 65 (Annual)</label>
                                <span class="tooltip" data-lang-key-tooltip="cppTooltip">?</span>
                                <input type="number" id="userCppAt65" value="10000">
                            </div>
                             <div class="form-group">
                                <label for="oasStartAge_a" data-lang-key="oasStartAgeLabel">OAS Start Age</label>
                                <input type="number" id="oasStartAge_a" value="65">
                            </div>
                        </fieldset>

                        <fieldset>
                            <legend data-lang-key="legendSpouseInfoControl">Spouse Control</legend>
                            <div class="form-group">
                                <input type="checkbox" id="hasSpouse" checked> <label for="hasSpouse" data-lang-key="hasSpouseLabel">Include Spouse's Information</label>
                                <p class="spouse-note" data-lang-key="spouseInfoNote">Note: Spouse info is entered via the 'Data Entry For' dropdown above.</p>
                            </div>
                           </fieldset>

                        <fieldset>
                            <legend data-lang-key="legendAssets">Assets at Retirement</legend>
                            <div class="form-grid-assets"> <div class="form-group"> <label for="asset_rrsp" data-lang-key="assetRRSP">RRSP/RRIF</label> <input type="number" id="asset_rrsp" value="500000"> </div>
                                <div class="form-group"> <label for="asset_tfsa" data-lang-key="assetTFSA">TFSA</label> <input type="number" id="asset_tfsa" value="150000"> </div>
                                <div class="form-group"> <label for="asset_nonreg" data-lang-key="assetNonReg">Non-Registered</label> <input type="number" id="asset_nonreg" value="100000"> </div>
                                <div class="form-group"> <label for="asset_lif" data-lang-key="assetLIF">LIF</label> <input type="number" id="asset_lif" value="0"> </div>
                                 <div class="form-group">
                                    <label for="asset_nonreg_acb" data-lang-key="assetNonRegACB">Non-Reg ACB</label>
                                    <span class="tooltip" data-lang-key-tooltip="acbTooltip">?</span>
                                    <input type="number" id="asset_nonreg_acb" value="75000">
                                </div>
                               </div>
                        </fieldset>

                        <fieldset>
                            <legend data-lang-key="legendGrowthAssumptionsIncome">Growth, Assumptions & Other Income</legend>
                            <div class="form-grid-4-col" style="margin-bottom: 1.5rem;"> <div class="form-group"> <label for="return_rrsp" data-lang-key="returnRRSP">RRSP/RRIF (%)</label> <input type="number" id="return_rrsp" step="0.1" value="7"> </div>
                                <div class="form-group"> <label for="return_tfsa" data-lang-key="returnTFSA">TFSA (%)</label> <input type="number" id="return_tfsa" step="0.1" value="7"> </div>
                                <div class="form-group"> <label for="return_nonreg" data-lang-key="returnNonReg">Non-Reg (%)</label> <input type="number" id="return_nonreg" step="0.1" value="7"> </div>
                                <div class="form-group"> <label for="return_lif" data-lang-key="returnLIF">LIF (%)</label> <input type="number" id="return_lif" step="0.1" value="5"> </div>
                            </div>
                            <div style="margin-bottom: 1.5rem;"> <div class="form-group"> <label for="cola" data-lang-key="colaLabel">Global COLA (%)</label> <input type="number" id="cola" step="0.1" value="2.5"> </div>
                            </div>
                             <hr style="border-top: 1px dashed var(--border-color); margin: 1.5rem 0;">
                            <div> <label data-lang-key="legendOtherIncome">Other Income (Non-CPP)</label>
                                <p data-lang-key="otherIncomeDesc" style="margin-bottom: 0.5rem; font-size: 0.9em;">Manage other sources of income you expect in retirement.</p>
                                <button id="manage-income-btn" type="button" data-lang-key="manageIncomeBtn">[ Manage Other Income ]</button>
                            </div>
                        </fieldset>
                        </div>

                    <div class="strategy-section">
                        <h2 data-lang-key="withdrawalStrategyTitle">Withdrawal Strategy (Scenario A)</h2>
                        <p data-lang-key="withdrawalStrategyNote">Note: This strategy applies sequentially to available funds from both individuals based on account type order.</p>
                        <div class="phase-item fixed-phase" id="phase-1-a">
                             <h3 data-lang-key="phase1Title">Phase 1</h3>
                             <div class="phase-settings">
                                <div class="form-group"> <label for="phase1_startAge_a" data-lang-key="phaseStartAge">Start Age</label> <input type="number" id="phase1_startAge_a" value="61"> </div>
                                <div class="form-group"> <label for="phase1_endAge_a" data-lang-key="phaseEndAge">End Age</label> <input type="number" id="phase1_endAge_a" value="64"> </div>
                                <div class="form-group"> <label for="phase1_expenses_a" data-lang-key="phaseExpenses">Annual Expenses (PV)</label> <input type="number" id="phase1_expenses_a" value="60000"> </div>
                            </div>
                            <div class="withdrawal-order-section">
                                <h4 data-lang-key="withdrawalOrder">Withdrawal Order</h4>
                                <div class="form-group"> <label for="phase1_order1_a">1st</label> <select id="phase1_order1_a" class="withdrawal-order-select"> </select> </div>
                                <div class="form-group"> <label for="phase1_order2_a">2nd</label> <select id="phase1_order2_a" class="withdrawal-order-select"> </select> </div>
                                <div class="form-group"> <label for="phase1_order3_a">3rd</label> <select id="phase1_order3_a" class="withdrawal-order-select"> </select> </div>
                                <div class="form-group"> <label for="phase1_order4_a">4th</label> <select id="phase1_order4_a" class="withdrawal-order-select"> </select> </div>
                            </div>
                        </div>
                        <div class="phase-item fixed-phase" id="phase-2-a">
                             <h3 data-lang-key="phase2Title">Phase 2</h3>
                             <div class="phase-settings">
                                <div class="form-group"> <label for="phase2_startAge_a" data-lang-key="phaseStartAge">Start Age</label> <input type="number" id="phase2_startAge_a" value="65"> </div>
                                <div class="form-group"> <label for="phase2_endAge_a" data-lang-key="phaseEndAge">End Age</label> <input type="number" id="phase2_endAge_a" value="71"> </div>
                                <div class="form-group"> <label for="phase2_expenses_a" data-lang-key="phaseExpenses">Annual Expenses (PV)</label> <input type="number" id="phase2_expenses_a" value="60000"> </div>
                            </div>
                            <div class="withdrawal-order-section">
                                <h4 data-lang-key="withdrawalOrder">Withdrawal Order</h4>
                                <div class="form-group"> <label for="phase2_order1_a">1st</label> <select id="phase2_order1_a" class="withdrawal-order-select"> </select> </div>
                                <div class="form-group"> <label for="phase2_order2_a">2nd</label> <select id="phase2_order2_a" class="withdrawal-order-select"> </select> </div>
                                <div class="form-group"> <label for="phase2_order3_a">3rd</label> <select id="phase2_order3_a" class="withdrawal-order-select"> </select> </div>
                                <div class="form-group"> <label for="phase2_order4_a">4th</label> <select id="phase2_order4_a" class="withdrawal-order-select"> </select> </div>
                            </div>
                        </div>
                        <div class="phase-item fixed-phase" id="phase-3-a">
                            <h3 data-lang-key="phase3Title">Phase 3</h3>
                            <div class="phase-settings">
                                <div class="form-group"> <label for="phase3_startAge_a" data-lang-key="phaseStartAge">Start Age</label> <input type="number" id="phase3_startAge_a" value="72"> </div>
                                <div class="form-group"> <label for="phase3_endAge_a" data-lang-key="phaseEndAge">End Age</label> <input type="number" id="phase3_endAge_a" value="95"> </div>
                                <div class="form-group"> <label for="phase3_expenses_a" data-lang-key="phaseExpenses">Annual Expenses (PV)</label> <input type="number" id="phase3_expenses_a" value="55000"> </div>
                            </div>
                            <div class="withdrawal-order-section">
                                <h4 data-lang-key="withdrawalOrder">Withdrawal Order</h4>
                                <div class="form-group"> <label for="phase3_order1_a">1st</label> <select id="phase3_order1_a" class="withdrawal-order-select"> </select> </div>
                                <div class="form-group"> <label for="phase3_order2_a">2nd</label> <select id="phase3_order2_a" class="withdrawal-order-select"> </select> </div>
                                <div class="form-group"> <label for="phase3_order3_a">3rd</label> <select id="phase3_order3_a" class="withdrawal-order-select"> </select> </div>
                                <div class="form-group"> <label for="phase3_order4_a">4th</label> <select id="phase3_order4_a" class="withdrawal-order-select"> </select> </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="scenarioB-pane" class="tab-pane">
                 <div class="input-section">
                    <h2 data-lang-key="section1Title">1. Enter Information (Scenario B)</h2>

                     <div class="form-group data-entry-target-selector">
                        <label for="dataEntryTarget_b" data-lang-key="dataEntryTargetLabel">Data Entry For:</label>
                        <select id="dataEntryTarget_b">
                            <option value="user" data-lang-key="dataEntryMe">Me</option>
                            <option value="spouse" data-lang-key="dataEntrySpouse">Spouse</option>
                        </select>
                    </div>

                    <div class="form-grid">
                         <fieldset>
                            <legend data-lang-key="legendBasicInfo">Basic Information</legend>
                            <div class="form-group">
                                <label for="province_b" data-lang-key="provinceLabel">Province of Residence</label>
                                <select id="province_b"></select>
                            </div>
                            <div class="form-group">
                                <label for="retirementAge_b" data-lang-key="retirementAgeLabel">Retirement Age</label>
                                <input type="number" id="retirementAge_b" value="70"> </div>
                            <div class="form-group">
                                <label for="lifeExpectancy_b" data-lang-key="lifeExpectancyLabel">Maximum Calculation Age</label>
                                <input type="number" id="lifeExpectancy_b" value="95">
                            </div>
                        </fieldset>
                        <fieldset>
                            <legend data-lang-key="legendYourInfo">Income Plan</legend> <div class="form-group">
                                <label for="userBirthYear_b" data-lang-key="userBirthYearLabel">Birth Year</label>
                                <input type="number" id="userBirthYear_b" value="1981">
                            </div>
                            <div class="form-group">
                                <label for="cppStartAge_b" data-lang-key="cppStartAgeLabel">CPP Start Age</label>
                                <input type="number" id="cppStartAge_b" value="70"> </div>
                            <div class="form-group">
                                <label for="userCppAt65_b" data-lang-key="userCppAt65Label">Estimated CPP at 65 (Annual)</label>
                                <span class="tooltip" data-lang-key-tooltip="cppTooltip">?</span>
                                <input type="number" id="userCppAt65_b" value="10000">
                            </div>
                            <div class="form-group">
                                <label for="oasStartAge_b" data-lang-key="oasStartAgeLabel">OAS Start Age</label>
                                <input type="number" id="oasStartAge_b" value="70"> </div>
                        </fieldset>
                        <fieldset>
                             <legend data-lang-key="legendSpouseInfoControl">Spouse Control</legend>
                            <div class="form-group">
                                <input type="checkbox" id="hasSpouse_b" checked> <label for="hasSpouse_b" data-lang-key="hasSpouseLabel">Include Spouse's Information</label>
                                <p class="spouse-note" data-lang-key="spouseInfoNote">Note: Spouse info is entered via the 'Data Entry For' dropdown above.</p>
                            </div>
                         </fieldset>
                        <fieldset>
                            <legend data-lang-key="legendAssets">Assets at Retirement</legend>
                             <div class="form-grid-assets"> <div class="form-group"> <label for="asset_rrsp_b" data-lang-key="assetRRSP">RRSP/RRIF</label> <input type="number" id="asset_rrsp_b" value="700000"> </div>
                                <div class="form-group"> <label for="asset_tfsa_b" data-lang-key="assetTFSA">TFSA</label> <input type="number" id="asset_tfsa_b" value="200000"> </div>
                                <div class="form-group"> <label for="asset_nonreg_b" data-lang-key="assetNonReg">Non-Registered</label> <input type="number" id="asset_nonreg_b" value="120000"> </div>
                                <div class="form-group"> <label for="asset_lif_b" data-lang-key="assetLIF">LIF</label> <input type="number" id="asset_lif_b" value="0"> </div>
                                <div class="form-group">
                                    <label for="asset_nonreg_acb_b" data-lang-key="assetNonRegACB">Non-Reg ACB</label>
                                    <span class="tooltip" data-lang-key-tooltip="acbTooltip">?</span>
                                    <input type="number" id="asset_nonreg_acb_b" value="90000">
                                </div>
                                </div>
                        </fieldset>

                        <fieldset>
                            <legend data-lang-key="legendGrowthAssumptionsIncome">Growth, Assumptions & Other Income</legend>
                             <div class="form-grid-4-col" style="margin-bottom: 1.5rem;"> <div class="form-group"> <label for="return_rrsp_b" data-lang-key="returnRRSP">RRSP/RRIF (%)</label> <input type="number" id="return_rrsp_b" step="0.1" value="7"> </div>
                                <div class="form-group"> <label for="return_tfsa_b" data-lang-key="returnTFSA">TFSA (%)</label> <input type="number" id="return_tfsa_b" step="0.1" value="7"> </div>
                                <div class="form-group"> <label for="return_nonreg_b" data-lang-key="returnNonReg">Non-Reg (%)</label> <input type="number" id="return_nonreg_b" step="0.1" value="7"> </div>
                                <div class="form-group"> <label for="return_lif_b" data-lang-key="returnLIF">LIF (%)</label> <input type="number" id="return_lif_b" step="0.1" value="5"> </div>
                            </div>
                            <div style="margin-bottom: 1.5rem;"> <div class="form-group"> <label for="cola_b" data-lang-key="colaLabel">Global COLA (%)</label> <input type="number" id="cola_b" step="0.1" value="2.5"> </div>
                            </div>
                             <hr style="border-top: 1px dashed var(--border-color); margin: 1.5rem 0;">
                            <div> <label data-lang-key="legendOtherIncome">Other Income (Non-CPP)</label>
                                <p data-lang-key="otherIncomeDesc" style="margin-bottom: 0.5rem; font-size: 0.9em;">Manage other sources of income you expect in retirement.</p>
                                <button id="manage-income-btn_b" type="button" data-lang-key="manageIncomeBtn">[ Manage Other Income ]</button>
                            </div>
                        </fieldset>
                         </div>
                    <div class="strategy-section">
                        <h2 data-lang-key="withdrawalStrategyTitle">Withdrawal Strategy (Scenario B)</h2>
                         <p data-lang-key="withdrawalStrategyNote">Note: This strategy applies sequentially to available funds from both individuals based on account type order.</p>
                        <div class="phase-item fixed-phase" id="phase-1-b">
                             <h3 data-lang-key="phase1Title">Phase 1</h3> <div class="phase-settings">
                                <div class="form-group"> <label for="phase1_startAge_b" data-lang-key="phaseStartAge">Start Age</label> <input type="number" id="phase1_startAge_b" value="70"> </div> <div class="form-group"> <label for="phase1_endAge_b" data-lang-key="phaseEndAge">End Age</label> <input type="number" id="phase1_endAge_b" value="71"> </div> <div class="form-group"> <label for="phase1_expenses_b" data-lang-key="phaseExpenses">Annual Expenses (PV)</label> <input type="number" id="phase1_expenses_b" value="65000"> </div> </div>
                            <div class="withdrawal-order-section">
                                <h4 data-lang-key="withdrawalOrder">Withdrawal Order</h4>
                                <div class="form-group"> <label for="phase1_order1_b">1st</label> <select id="phase1_order1_b" class="withdrawal-order-select"> </select> </div>
                                <div class="form-group"> <label for="phase1_order2_b">2nd</label> <select id="phase1_order2_b" class="withdrawal-order-select"> </select> </div>
                                <div class="form-group"> <label for="phase1_order3_b">3rd</label> <select id="phase1_order3_b" class="withdrawal-order-select"> </select> </div>
                                <div class="form-group"> <label for="phase1_order4_b">4th</label> <select id="phase1_order4_b" class="withdrawal-order-select"> </select> </div>
                            </div>
                        </div>
                        <div class="phase-item fixed-phase" id="phase-2-b">
                             <h3 data-lang-key="phase2Title">Phase 2</h3> <div class="phase-settings">
                                <div class="form-group"> <label for="phase2_startAge_b" data-lang-key="phaseStartAge">Start Age</label> <input type="number" id="phase2_startAge_b" value="72"> </div> <div class="form-group"> <label for="phase2_endAge_b" data-lang-key="phaseEndAge">End Age</label> <input type="number" id="phase2_endAge_b" value="95"> </div> <div class="form-group"> <label for="phase2_expenses_b" data-lang-key="phaseExpenses">Annual Expenses (PV)</label> <input type="number" id="phase2_expenses_b" value="65000"> </div> </div>
                            <div class="withdrawal-order-section">
                                <h4 data-lang-key="withdrawalOrder">Withdrawal Order</h4>
                                <div class="form-group"> <label for="phase2_order1_b">1st</label> <select id="phase2_order1_b" class="withdrawal-order-select"> </select> </div>
                                <div class="form-group"> <label for="phase2_order2_b">2nd</label> <select id="phase2_order2_b" class="withdrawal-order-select"> </select> </div>
                                <div class="form-group"> <label for="phase2_order3_b">3rd</label> <select id="phase2_order3_b" class="withdrawal-order-select"> </select> </div>
                                <div class="form-group"> <label for="phase2_order4_b">4th</label> <select id="phase2_order4_b" class="withdrawal-order-select"> </select> </div>
                            </div>
                        </div>
                        <div class="phase-item fixed-phase" id="phase-3-b">
                             <h3 data-lang-key="phase3Title">Phase 3</h3> <div class="phase-settings">
                                <div class="form-group"> <label for="phase3_startAge_b" data-lang-key="phaseStartAge">Start Age</label> <input type="number" id="phase3_startAge_b" value="96" disabled> </div>
                                <div class="form-group"> <label for="phase3_endAge_b" data-lang-key="phaseEndAge">End Age</label> <input type="number" id="phase3_endAge_b" value="95" disabled> </div>
                                <div class="form-group"> <label for="phase3_expenses_b" data-lang-key="phaseExpenses">Annual Expenses (PV)</label> <input type="number" id="phase3_expenses_b" value="0" disabled> </div>
                            </div>
                            <div class="withdrawal-order-section">
                                <h4 data-lang-key="withdrawalOrder">Withdrawal Order</h4>
                                <div class="form-group"> <label for="phase3_order1_b">1st</label> <select id="phase3_order1_b" class="withdrawal-order-select" disabled> </select> </div>
                                <div class="form-group"> <label for="phase3_order2_b">2nd</label> <select id="phase3_order2_b" class="withdrawal-order-select" disabled> </select> </div>
                                <div class="form-group"> <label for="phase3_order3_b">3rd</label> <select id="phase3_order3_b" class="withdrawal-order-select" disabled> </select> </div>
                                <div class="form-group"> <label for="phase3_order4_b">4th</label> <select id="phase3_order4_b" class="withdrawal-order-select" disabled> </select> </div>
                            </div>
                        </div>
                         </div>
                </div>
            </div>

            <div id="results-pane" class="tab-pane">
                 <div class="output-section">
                    <h2 data-lang-key="section2Title">2. Analysis Results</h2>

                    <div class="form-group" style="text-align: center; margin: 2rem 0;">
                        <button id="runAnalysisBtn" type="button" data-lang-key="runAnalysisBtn">Run Analysis</button>
                    </div>

                    <div id="loading-indicator" class="hidden"> <p data-lang-key="loadingText">Calculating...</p> <div class="spinner"></div> </div>
                    <div id="results-container" class="hidden">
                        <div id="break-even-result">
                            <p id="break-even-text-result"></p>
                            <div id="additional-metrics-container"></div>
                        </div>

                        <div id="graph-container" class="hidden">
                             <h3>Asset Comparison Graph</h3> 
                             <svg id="results-chart"></svg>
                        </div>
                        <div class="detailed-table-section">
                            <div class="table-controls">

                                <button id="toggle-graph-btn" type="button" class="hidden" data-lang-key="toggleGraphBtn">Show/Hide Graph</button>
                                
                                
<button id="toggle-details-btn" type="button" class="hidden" data-lang-key="toggleTableBtn">Show/Hide Detailed Data</button>
                                <button id="export-csv-btn" type="button" class="hidden" data-lang-key="exportCsvBtn">Export to CSV</button>
                            </div>
                            <div id="detailed-table-container" class="hidden"></div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <div class="footer-credits"> <p>© 2025 dluvbell. All Rights Reserved.</p> <p data-lang-key="createdBy">Created by <a href="https://github.com/dluvbell" target="_blank" rel="noopener noreferrer">dluvbell</a>.</p> </div>
            <h3 data-lang-key="disclaimerTitle">Disclaimer</h3>
            <p data-lang-key="disclaimerP1">For information only.</p>
            <p data-lang-key="disclaimerP2">Results are estimates. Not financial advice.</p>
            <p data-lang-key="disclaimerP3">Consult a professional.</p>
        </footer>
    </div>

     <div id="welcome-modal" class="modal">
         <div class="modal-content">
            <button id="modal-lang-toggle" type="button">한국어</button>
            <span class="close-button">&times;</span>
            <h2 data-lang-key="welcomeTitle">Welcome!</h2>
            <p data-lang-key="welcomeP1">This tool helps you compare two potential retirement scenarios.</p>
            <h3 data-lang-key="resultsHeader">Results Summary</h3>
            <p data-lang-key="resultsP1">The simulator calculates year-by-year projections based on your inputs for two different scenarios (A and B).</p>
            <p data-lang-key="resultsP2">Results include asset growth, income sources (CPP, OAS, GIS, Other), expenses, withdrawals according to your strategy, and estimated taxes.</p>
            <h3 data-lang-key="disclaimerTitle">Disclaimer</h3>
            <p data-lang-key="disclaimerP2">Results are estimates based on provided inputs and assumptions. This is not financial advice.</p>
             <p data-lang-key="disclaimerP3">Consult with a qualified financial professional before making any decisions.</p>
            <div class="agreement-section">
                <input type="checkbox" id="disclaimer-agree">
                <label for="disclaimer-agree" data-lang-key="agreeLabel">I understand and agree.</label>
            </div>
            <button id="agree-btn" type="button" data-lang-key="confirmBtn" disabled>Confirm</button>
         </div>
     </div>

     <div id="income-modal" class="modal hidden">
         <div class="modal-content">
             <span class="close-button">&times;</span>
             <h2 data-lang-key="modalTitle">Manage Other Income (A)</h2>
             <div id="income-list"></div>
             <hr>
             <h3 data-lang-key="modalAddTitle">Add/Edit Income</h3>
             <div id="add-income-form" class="form-grid-modal">
                 <input type="hidden" id="income-id">
                 <div class="form-group"><label for="income-desc" data-lang-key="incomeDescLabel">Type</label><input type="text" id="income-desc"></div>
                 <div class="form-group"><label for="income-amount" data-lang-key="incomeAmountLabel">Amount (PV)</label><input type="number" id="income-amount"><div class="future-value-display" id="future-value-display"></div></div>
                 <div class="form-group"><label for="income-start-age" data-lang-key="incomeStartAgeLabel">Start Age</label><input type="number" id="income-start-age"></div>
                 <div class="form-group"><label for="income-end-age" data-lang-key="incomeEndAgeLabel">End Age</label><input type="number" id="income-end-age"></div>
                 <div class="form-group">
                    <label for="income-owner" data-lang-key="incomeOwnerLabel">Owner</label>
                    <select id="income-owner">
                        <option value="user" data-lang-key="dataEntryMe">Me</option>
                        <option value="spouse" data-lang-key="dataEntrySpouse">Spouse</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="income-cola" data-lang-key="incomeColaLabel">COLA (%)</label>
                    <span class="tooltip" data-lang-key-tooltip="incomeColaTooltip">?</span>
                    <input type="number" id="income-cola" placeholder="0" step="0.1">
                </div>
                </div>
             <button id="save-income-btn" type="button" data-lang-key="saveIncomeBtn">Save</button>
         </div>
     </div>
     <div id="income-modal_b" class="modal hidden">
         <div class="modal-content">
             <span class="close-button">&times;</span>
             <h2 data-lang-key="modalTitle">Manage Other Income (B)</h2>
             <div id="income-list_b"></div>
             <hr>
             <h3 data-lang-key="modalAddTitle">Add/Edit Income</h3>
             <div id="add-income-form_b" class="form-grid-modal">
                 <input type="hidden" id="income-id_b">
                 <div class="form-group"><label for="income-desc_b" data-lang-key="incomeDescLabel">Type</label><input type="text" id="income-desc_b"></div>
                 <div class="form-group"><label for="income-amount_b" data-lang-key="incomeAmountLabel">Amount (PV)</label><input type="number" id="income-amount_b"><div class="future-value-display" id="future-value-display_b"></div></div>
                 <div class="form-group"><label for="income-start-age_b" data-lang-key="incomeStartAgeLabel">Start Age</label><input type="number" id="income-start-age_b"></div>
                 <div class="form-group"><label for="income-end-age_b" data-lang-key="incomeEndAgeLabel">End Age</label><input type="number" id="income-end-age_b"></div>
                 <div class="form-group">
                    <label for="income-owner_b" data-lang-key="incomeOwnerLabel">Owner</label>
                    <select id="income-owner_b">
                        <option value="user" data-lang-key="dataEntryMe">Me</option>
                        <option value="spouse" data-lang-key="dataEntrySpouse">Spouse</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="income-cola_b" data-lang-key="incomeColaLabel">COLA (%)</label>
                    <span class="tooltip" data-lang-key-tooltip="incomeColaTooltip">?</span>
                    <input type="number" id="income-cola_b" placeholder="0" step="0.1">
                </div>
                </div>
             <button id="save-income-btn_b" type="button" data-lang-key="saveIncomeBtn">Save</button>
         </div>
     </div>

       <script src="https://d3js.org/d3.v7.min.js"></script> <script src="data.js"></script>
       <script src="incomeTaxEngine.js"></script>
       <script src="withdrawalEngine.js"></script>
       <script src="engineCore.js"></script>
       <script src="uiCore.js"></script> <script src="uiDataHandler.js"></script>
       <script src="uiIncomeModal.js"></script>
       <script src="uiResultsDisplay.js"></script> </body>
</html>
}

{
type: uploaded file
fileName: data.js
fullContent:
// data.js

// Note: All data are examples simplified based on 2025 or latest available info.
// Real applications require annual updates.

const taxData = {
    FED: {
        bpa: 15705, // Basic Personal Amount for 2025 (Example)
        brackets: [
            { upTo: 55867, rate: 0.15 },    // Up to $55,867
            { upTo: 111733, rate: 0.205 }, // Over $55,867 up to $111,733
            { upTo: 173205, rate: 0.26 },  // Over $111,733 up to $173,205
            { upTo: 246752, rate: 0.29 },  // Over $173,205 up to $246,752
            { over: 246752, rate: 0.33 }  // Over $246,752
        ],
        credits: {
            ageAmount: 8790,           // Base amount for Age Amount credit (65+)
            ageAmountThreshold: 42335, // Income threshold for Age Amount reduction (Needs indexing)
            pensionIncomeAmount: 2000  // Maximum base for Pension Income credit
        }
    },
    ON: {
        bpa: 12399, // Ontario BPA 2025 (Example)
        brackets: [
            { upTo: 51446, rate: 0.0505 }, // Up to $51,446
            { upTo: 102894, rate: 0.0915 }, // Over $51,446 up to $102,894
            { upTo: 150000, rate: 0.1116 }, // Over $102,894 up to $150,000
            { upTo: 220000, rate: 0.1216 }, // Over $150,000 up to $220,000
            { over: 220000, rate: 0.1316 }  // Over $220,000
        ],
        credits: {
            ageAmount: 5543,            // Ontario Age Amount base
            ageAmountThreshold: 42335,  // Assumed same threshold as Federal for simplicity
            pensionIncomeAmount: 1629   // Ontario Pension Income credit base
        },
        // Ontario Surtax (Example values, needs verification and indexing)
        surtax: {
            threshold1: 5503, // Provincial tax threshold 1
            rate1: 0.20,       // Surtax rate 1 (20% on tax between threshold1 and threshold2)
            threshold2: 6980, // Provincial tax threshold 2
            rate2: 0.36        // Surtax rate 2 (36% on tax over threshold2, added to rate1 effect)
        }
    },
    BC: { // British Columbia - Example Data
        bpa: 12580,
        brackets: [
            { upTo: 47937, rate: 0.0506 },
            { upTo: 95875, rate: 0.077 },
            { upTo: 110070, rate: 0.105 },
            { upTo: 133664, rate: 0.1229 },
            { upTo: 181232, rate: 0.147 },
            { upTo: 252752, rate: 0.168 },
            { over: 252752, rate: 0.205 }
        ],
        credits: {
            ageAmount: 5267,
            pensionIncomeAmount: 1000
            // BC may have different thresholds or surtaxes not included here
        }
    },
    AB: { // Alberta - Example Data
        bpa: 21885,
        brackets: [ // Note: Alberta tax system might have changes not reflected here
            { upTo: 148269, rate: 0.10 },
            { upTo: 177922, rate: 0.12 },
            { upTo: 237230, rate: 0.13 },
            { upTo: 355845, rate: 0.14 },
            { over: 355845, rate: 0.15 }
        ],
        credits: {
            ageAmount: 6413,
            pensionIncomeAmount: 1000
            // Alberta credits/deductions might differ
        }
    }
    // Add other provinces as needed...
};

const govBenefitsData = {
    OAS: {
        clawbackThreshold: 90997, // 2025 threshold (Example, needs indexing)
        clawbackRate: 0.15,
        maxPayment2025: 8881 // Annual max OAS at 65 (Example for Jan-Mar 2025 rate annualized)
    },
    GIS: {
        // Example thresholds and payments for 2025 (Need annual updates)
        // Scenario: Couple, both receiving OAS
        maxPaymentCoupleTotal: 15970, // Max GIS for the couple combined, annually
        incomeThresholdCouple: 29616, // Combined income threshold for couple
        // Scenario: Single person
        maxPaymentSingle: 13083, // Max GIS for a single person, annually
        incomeThresholdSingle: 21624, // Income threshold for single
        // General Rules (Simplified)
        exemption: 5000, // First $5000 of employment income exempt (simplified rule application)
        reductionRate: 0.5 // GIS reduced by $0.50 for every $1 of income over exemption
    }
};

// *** MODIFICATION START: RRIF/LIF Minimum Withdrawal Rates ***
// Source: Government of Canada, Income Tax Act Regulations, Schedule. Adjusted to percentage.
// Applies to both RRIF and LIF minimums.
const rrifLifMinimumRates = [
    { age: 71, rate: 0.0528 }, { age: 72, rate: 0.0540 }, { age: 73, rate: 0.0553 },
    { age: 74, rate: 0.0567 }, { age: 75, rate: 0.0582 }, { age: 76, rate: 0.0598 },
    { age: 77, rate: 0.0617 }, { age: 78, rate: 0.0636 }, { age: 79, rate: 0.0658 },
    { age: 80, rate: 0.0681 }, { age: 81, rate: 0.0708 }, { age: 82, rate: 0.0738 },
    { age: 83, rate: 0.0771 }, { age: 84, rate: 0.0808 }, { age: 85, rate: 0.0851 },
    { age: 86, rate: 0.0899 }, { age: 87, rate: 0.0955 }, { age: 88, rate: 0.1021 },
    { age: 89, rate: 0.1099 }, { age: 90, rate: 0.1192 }, { age: 91, rate: 0.1306 },
    { age: 92, rate: 0.1449 }, { age: 93, rate: 0.1634 }, { age: 94, rate: 0.1879 },
    // Age 95 and over use a flat 20% rate
];
const rrifLifMinRateAge95Plus = 0.20;
// *** MODIFICATION END ***

// *** MODIFICATION START: Ontario LIF Maximum Withdrawal Factors ***
// Source: FSRAO website or financial institution summaries based on Pension Benefits Act, R.S.O. 1990, c. P.8, Reg 909.
// Factor = 1 / (90 - age) for ages below 80, specific factors thereafter. Simplified below.
// This is Factor 'F' used in the formula: Max Withdrawal = Balance * Factor
const ontarioLifMaximumFactors = [
    // Example: Using the standard 1/(90-age) for ages < 80 and simplified factors after.
    // Real implementation should use the precise factors from regulation for each age.
    { age: 55, factor: 1/(90-55) }, { age: 56, factor: 1/(90-56) }, { age: 57, factor: 1/(90-57) },
    { age: 58, factor: 1/(90-58) }, { age: 59, factor: 1/(90-59) }, { age: 60, factor: 1/(90-60) },
    { age: 61, factor: 1/(90-61) }, { age: 62, factor: 1/(90-62) }, { age: 63, factor: 1/(90-63) },
    { age: 64, factor: 1/(90-64) }, { age: 65, factor: 1/(90-65) }, { age: 66, factor: 1/(90-66) },
    { age: 67, factor: 1/(90-67) }, { age: 68, factor: 1/(90-68) }, { age: 69, factor: 1/(90-69) },
    { age: 70, factor: 1/(90-70) }, { age: 71, factor: 1/(90-71) }, { age: 72, factor: 1/(90-72) },
    { age: 73, factor: 1/(90-73) }, { age: 74, factor: 1/(90-74) }, { age: 75, factor: 1/(90-75) },
    { age: 76, factor: 1/(90-76) }, { age: 77, factor: 1/(90-77) }, { age: 78, factor: 1/(90-78) },
    { age: 79, factor: 1/(90-79) }, // Up to here uses 1/(90-age)
    // Ages 80+ factors (Example - use precise regulated factors if needed)
    { age: 80, factor: 0.088 }, { age: 81, factor: 0.093 }, { age: 82, factor: 0.099 },
    { age: 83, factor: 0.106 }, { age: 84, factor: 0.114 }, { age: 85, factor: 0.123 },
    { age: 86, factor: 0.134 }, { age: 87, factor: 0.147 }, { age: 88, factor: 0.163 },
    { age: 89, factor: 0.183 }, { age: 90, factor: 0.200 }, // Assume 20% cap from 90 onwards for simplicity
    // Note: Some jurisdictions allow 100% withdrawal after a certain age (e.g., 90 or 95). Ontario max continues based on factors.
];
const lifMaxFactorAge90Plus = 0.20; // Simplified assumption for this example
// *** MODIFICATION END ***


// Portfolio Profiles - Not currently used by the engine but kept for potential future Monte Carlo integration
const portfolioProfiles = {
    conservative: {
        name: "보수적 (Conservative)",
        avgReturn: 0.04,
        stdDev: 0.06
    },
    balanced: {
        name: "안정형 (Balanced)",
        avgReturn: 0.07,
        stdDev: 0.12
    },
    aggressive: {
        name: "성장형 (Growth)",
        avgReturn: 0.09,
        stdDev: 0.18
    }
};
}
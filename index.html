<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="dluvbell">
    <title data-lang-key="pageTitle">CPP Break-Even Simulator</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <div class="container">
        <header>
            <h1 data-lang-key="mainTitle">CPP Break-Even Simulator</h1>
            <p data-lang-key="subTitle">Compare two CPP start dates to find your after-tax break-even point.</p>
            <div class="header-controls">
                <div class="theme-switch-wrapper">
                    <label class="theme-switch" for="theme-toggle">
                        <input type="checkbox" id="theme-toggle" />
                        <div class="slider round"></div>
                    </label>
                    <span data-lang-key="darkModeLabel">Dark Mode</span>
                </div>
                <button id="lang-toggle" type="button">한국어</button>
            </div>
        </header>

        <main>
            <div class="input-section">
                <h2 data-lang-key="section1Title">1. Enter Information</h2>
                <div class="form-grid">
                    <fieldset>
                        <legend data-lang-key="legendBasicInfo">Basic Information</legend>
                        <div class="form-group">
                            <label for="province" data-lang-key="provinceLabel">Province of Residence</label>
                            <select id="province"></select>
                        </div>
                    </fieldset>
                    <fieldset>
                        <legend data-lang-key="legendYourInfo">Your Information</legend>
                        <div class="form-group">
                            <label for="userBirthYear" data-lang-key="userBirthYearLabel">Birth Year</label>
                            <input type="number" id="userBirthYear" value="1981">
                        </div>
                        <div class="form-group">
                            <label for="userCppAt65" data-lang-key="userCppAt65Label">Estimated CPP at 65 (Annual)</label>
                            <span class="tooltip" data-lang-key-tooltip="cppTooltip">?</span>
                            <input type="number" id="userCppAt65" value="10000">
                        </div>
                    </fieldset>
                    <fieldset>
                        <legend data-lang-key="legendSpouseInfo">Spouse's Information</legend>
                        <div class="form-group">
                            <input type="checkbox" id="hasSpouse" checked>
                            <label for="hasSpouse" data-lang-key="hasSpouseLabel">Include Spouse's Information</label>
                        </div>
                        <div id="spouse-info-group">
                            <div class="form-group">
                                <label for="spouseBirthYear" data-lang-key="spouseBirthYearLabel">Spouse's Birth Year</label>
                                <input type="number" id="spouseBirthYear" value="1982">
                            </div>
                            <div class="form-group">
                                <label for="spouseCppAt65" data-lang-key="spouseCppAt65Label">Spouse's Est. CPP at 65 (Annual)</label>
                                <span class="tooltip" data-lang-key-tooltip="cppTooltip">?</span>
                                <input type="number" id="spouseCppAt65" value="4000">
                            </div>
                        </div>
                    </fieldset>
                    <fieldset>
                        <legend data-lang-key="legendOtherIncome">Other Income (Non-CPP)</legend>
                        <p data-lang-key="otherIncomeDesc">Manage other sources of income you expect in retirement.</p>
                        <button id="manage-income-btn" type="button" data-lang-key="manageIncomeBtn">[ Manage Other Income ]</button>
                    </fieldset>
                    <fieldset>
                        <legend data-lang-key="legendAssumptions">Key Assumptions</legend>
                         <div class="form-group">
                            <label for="investmentReturn" data-lang-key="investmentReturnLabel">Initial Investment Return (%)</label>
                             <span class="tooltip" data-lang-key-tooltip="investmentTooltip">?</span>
                            <input type="number" id="investmentReturn" step="0.1" value="11">
                        </div>
                        <div class="form-group">
                            <label for="cola" data-lang-key="colaLabel">Cost of Living Adj. (COLA, %)</label>
                            <input type="number" id="cola" step="0.1" value="3">
                        </div>
                        <div class="form-group">
                            <label for="lifeExpectancy" data-lang-key="lifeExpectancyLabel">Maximum Calculation Age</label>
                            <input type="number" id="lifeExpectancy" value="100">
                        </div>
                    </fieldset>
                     <fieldset>
                        <legend data-lang-key="legendAnalysisScenario">Analysis Scenario</legend>
                         <div class="form-group">
                            <label for="break-even-base" data-lang-key="baseAgeLabel">Base Age (Start Earlier):</label>
                            <select id="break-even-base"></select>
                         </div>
                         <div class="form-group">
                            <label for="break-even-comparison" data-lang-key="comparisonAgeLabel">Comparison Age (Start Later):</label>
                            <select id="break-even-comparison"></select>
                         </div>
                         <button id="run-break-even-btn" type="button" data-lang-key="runAnalysisBtn">Run Break-Even Analysis</button>
                    </fieldset>
                </div>
            </div>

            <div class="output-section">
                <h2 data-lang-key="section2Title">2. Analysis Results</h2>
                <div id="loading-indicator" class="hidden">
                    <p data-lang-key="loadingText">Calculating...</p>
                    <div class="spinner"></div>
                </div>
                <div id="results-container" class="hidden">
                    <div id="break-even-result">
                         <p id="break-even-text-result"></p>
                         <div class="chart-container">
                            <h3 data-lang-key="chartTitle">Break-Even Visualization</h3>
                            <canvas id="breakEvenChart"></canvas>
                        </div>
                    </div>
                    <div class="detailed-table-section">
                        <div class="table-controls">
                            <button id="toggle-details-btn" type="button" class="hidden" data-lang-key="toggleTableBtn">Show Detailed Data Table</button>
                            <button id="export-csv-btn" type="button" class="hidden" data-lang-key="exportCsvBtn">Export to CSV</button>
                        </div>
                        <div id="detailed-table-container" class="hidden"></div>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <div class="footer-credits">
                <p>© 2025 dluvbell. All Rights Reserved.</p>
                <p data-lang-key="createdBy">Created by <a href="https://github.com/dluvbell" target="_blank" rel="noopener noreferrer">dluvbell</a>.</p>
            </div>
            <h3 data-lang-key="disclaimerTitle">Disclaimer</h3>
            <p data-lang-key="disclaimerP1">This simulator is for informational and educational purposes only.</p>
            <p data-lang-key="disclaimerP2">The results are based on the data provided and simplified assumptions and may not accurately reflect your actual financial situation. This content should not be considered financial, tax, or legal advice.</p>
            <p data-lang-key="disclaimerP3">You must consult with a qualified professional (e.g., CPA, CFP) before making any significant financial decisions.</p>
        </footer>

    </div>

    <div id="welcome-modal" class="modal">
        <div class="modal-content">
            <button id="modal-lang-toggle" type="button">한국어</button>
            <span class="close-button">&times;</span>
            <h2 data-lang-key="welcomeTitle">Welcome to the CPP Simulator!</h2>
            <p data-lang-key="welcomeP1">
                This tool helps you compare two different CPP start dates to find the financial break-even point.
            </p>
            
            <h3 data-lang-key="resultsHeader">Understanding the Results</h3>
            <p data-lang-key="resultsP1">
                <strong>Important:</strong> All key financial values in the results (e.g., Opportunity Cost, Cumulative Difference) are calculated on an <strong>after-tax basis</strong> to reflect the real amount of money you would have.
            </p>
            <p data-lang-key="resultsP2">
                The detailed table shows key metrics:
                - <strong>Target (Opp. Cost):</strong> The amount of money gained by taking CPP early and investing it. This is the "target" the later, larger CPP payments need to overcome.
                - <strong>Cumulative Diff.:</strong> The running total of the extra after-tax money you get from starting CPP later.
                - <strong>The break-even age</strong> is when the 'Cumulative Diff.' first surpasses the 'Target'.
            </p>

            <h3 data-lang-key="disclaimerTitle">Disclaimer</h3>
            <p data-lang-key="disclaimerP2">The results are based on the data provided and simplified assumptions and may not accurately reflect your actual financial situation. This content should not be considered financial, tax, or legal advice.</p>
            
            <div class="agreement-section">
                <input type="checkbox" id="disclaimer-agree">
                <label for="disclaimer-agree" data-lang-key="agreeLabel">I have read, understood, and agree to the terms above.</label>
            </div>
            <button id="agree-btn" type="button" data-lang-key="confirmBtn" disabled>Confirm</button>
        </div>
    </div>

    <div id="income-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2 data-lang-key="modalTitle">Manage Other Income</h2>
            <div id="income-list"></div>
            <hr>
            <h3 data-lang-key="modalAddTitle">Add/Edit Income</h3>
            <div id="add-income-form" class="form-grid-modal">
                <input type="hidden" id="income-id">
                <div class="form-group">
                    <label for="income-desc" data-lang-key="incomeDescLabel">Income Type</label>
                    <input type="text" id="income-desc" placeholder="e.g., Company Pension">
                </div>
                <div class="form-group">
                    <label data-lang-key="incomeAmountLabel">Amount (Annual, Present Value)</label>
                    <input type="number" id="income-amount">
                    <div class="future-value-display" id="future-value-display"></div>
                </div>
                <div class="form-group">
                    <label for="income-start-age" data-lang-key="incomeStartAgeLabel">Start Age</label>
                    <input type="number" id="income-start-age">
                </div>
                <div class="form-group">
                    <label for="income-end-age" data-lang-key="incomeEndAgeLabel">End Age</label>
                    <input type="number" id="income-end-age">
                </div>
            </div>
            <button id="save-income-btn" type="button" data-lang-key="saveIncomeBtn">Add/Update</button>
        </div>
    </div>

    <script src="data.js"></script>
    <script src="engine.js"></script>
    <script src="ui.js"></script>

</body>
</html>
